!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("lodash-es"),require("rxjs"),require("@angular/core"),require("@angular/common"),require("ng-zorro-antd")):"function"==typeof define&&define.amd?define("xc-wizard",["exports","lodash-es","rxjs","@angular/core","@angular/common","ng-zorro-antd"],i):i(t["xc-wizard"]={},t["lodash-es"],t.rxjs,t.ng.core,t.ng.common,t["ng-zorro-antd"])}(this,function(t,i,e,o,n,r){"use strict";var s=function(){function t(){}return t.store=function(t,i){if(window.localStorage)try{localStorage.setItem(t,JSON.stringify(i))}catch(e){console.log("no storage")}},t.get=function(t){if(window.localStorage)try{return localStorage.getItem(t)}catch(i){return null}},t.remove=function(t){if(window.localStorage)try{localStorage.removeItem(t)}catch(i){console.log("no storage")}},t.clearAll=function(){if(window.localStorage)try{localStorage.clear()}catch(t){console.log("no storage")}},t}(),c={TOP:0,RIGHT:1,BOTTOM:2,LEFT:3};c[c.TOP]="TOP",c[c.RIGHT]="RIGHT",c[c.BOTTOM]="BOTTOM",c[c.LEFT]="LEFT";var d={steps:undefined,skipForever:!0,skipKey:"skipWizard",boundaryWidth:15,scrollTopOffset:0,scrollBottomOffset:0,scroller:document.body,tipHeight:180,tipWidth:320,priority:[2,0,1,3]},h=function(){function t(){this.stepChange=new o.EventEmitter,this.arrowWidth=15,this._noWizard=!0,this.current=0,this.retryCount=0}return Object.defineProperty(t.prototype,"pos",{get:function(){return this.position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"noWizard",{get:function(){return this._noWizard},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentIndex",{get:function(){return this.current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this.domStyle?{width:this.domStyle.width+"px",height:(this.domStyle.height>document.body.clientHeight?document.body.clientHeight:this.domStyle.height)+"px","border-width":this.domStyle.borderTop+"px "+this.domStyle.borderRight+"px         "+this.domStyle.borderBottom+"px "+this.domStyle.borderLeft+"px"}:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"button",{get:function(){return this.config&&this.tipStyle&&(this.tipStyle.width=this.config.tipWidth+"px",this.tipStyle.height=this.config.tipHeight+"px"),this.tipStyle},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.config||(this._noWizard=!0),e.fromEvent(window,"resize").subscribe(function(){return t.detect()})},t.prototype.close=function(t){this._noWizard=!0,t&&this.config.skipForever&&s.store(""+this.config.skipKey,!0)},t.prototype.change=function(t){var i=this;this.stepChange.emit({prev:this.current,next:t}),this.current=t,setTimeout(function(){return i.detect()})},t.prototype.ngOnDestroy=function(){cancelAnimationFrame(this.detector)},t.prototype.ngOnChanges=function(t){t.config&&t.config.currentValue&&this.update()},t.prototype.update=function(){this.config=i.merge(i.cloneDeep(d),this.config),this._noWizard=!this.config.steps||!this.config.steps.length||!!this.config.skipForever&&!!s.get(this.config.skipKey),this.noWizard||this.detectElement()},t.prototype.detect=function(){var t=this;if(this.config&&this.config.steps&&this.config.steps.length&&this.current<this.config.steps.length){var i=document.querySelector(this.config.steps[this.current].id);if(i){var e=i.getBoundingClientRect(),o=this.config.scroller;if(!this.scrollToPosition(e,o)&&this.retryCount<3)return this.retryCount++,void setTimeout(function(){return t.detect()});this.retryCount=0,this.calcDom(e),this.calcTipDom(e)}else this.detectElement()}},t.prototype.detectElement=function(){this.detector=requestAnimationFrame(this.detect.bind(this))},t.prototype.calcDom=function(t){this.domStyle={width:t.width+2*this.config.boundaryWidth,height:t.height+2*this.config.boundaryWidth,borderTop:this.limitToPositive(t.top-this.config.boundaryWidth),borderLeft:this.limitToPositive(t.left-this.config.boundaryWidth),borderBottom:this.limitToPositive(document.body.clientHeight-t.top-t.height-this.config.boundaryWidth),borderRight:this.limitToPositive(document.body.clientWidth-t.left-t.width-this.config.boundaryWidth)}},t.prototype.prev=function(){var t=this,i=this.current;this.current--,this.current<0&&(this.current=0);var e=this.config.steps[i].prev;e&&e(),this.stepChange.emit({prev:i,next:this.current}),setTimeout(function(){t.carousel.goTo(t.current),t.detect()})},t.prototype.next=function(){var t=this,i=this.current;this.current++,this.current>=this.config.steps.length&&(this.current=this.config.steps.length-1);var e=this.config.steps[i].next;e&&e(),this.stepChange.emit({prev:i,next:this.current}),setTimeout(function(){t.carousel.goTo(t.current),t.detect()})},t.prototype.calcTipDom=function(t){var e=t.top-2*this.config.boundaryWidth-this.arrowWidth-this.config.tipHeight,o=document.body.clientHeight-2*this.config.boundaryWidth-t.top-t.height-this.arrowWidth-this.config.tipHeight,n=t.left-2*this.config.boundaryWidth-this.arrowWidth-this.config.tipWidth,r=document.body.clientWidth-2*this.config.boundaryWidth-t.left-t.width-this.arrowWidth-this.config.tipWidth,i=this.config.priority.map(function(t){var i;switch(t){case c.BOTTOM:i=o;break;case c.TOP:i=e;break;case c.LEFT:i=n;break;case c.RIGHT:i=r}return{direction:t,space:i}}).find(function(t){return 0<=t.space});switch(this.position=i?i.direction:c.BOTTOM,i.direction){case c.TOP:this.tipStyle={left:this.limitTipInWindow(this.domStyle.borderLeft,document.body.clientWidth,this.config.tipWidth)+"px",top:this.limitTipInWindow(this.domStyle.borderTop-this.config.tipHeight-this.arrowWidth,document.body.clientHeight,this.config.tipHeight)+"px"};break;case c.RIGHT:this.tipStyle={left:this.limitTipInWindow(this.domStyle.borderLeft+this.domStyle.width+this.arrowWidth,document.body.clientWidth,this.config.tipWidth)+"px",top:this.limitTipInWindow(this.domStyle.borderTop,document.body.clientHeight,this.config.tipHeight)+"px"};break;case c.BOTTOM:this.tipStyle={left:this.limitTipInWindow(this.domStyle.borderLeft,document.body.clientWidth,this.config.tipWidth)+"px",top:this.limitTipInWindow(this.domStyle.borderTop+this.domStyle.height+this.arrowWidth,document.body.clientHeight,this.config.tipHeight)+"px"};break;case c.LEFT:this.tipStyle={left:this.limitTipInWindow(this.domStyle.borderLeft-this.arrowWidth-this.config.tipWidth,document.body.clientWidth,this.config.tipWidth)+"px",top:this.limitTipInWindow(this.domStyle.borderTop,document.body.clientHeight,this.config.tipHeight)+"px"};break;default:console.log("no place")}},t.prototype.limitToPositive=function(t){return t<0?0:t},t.prototype.limitTipInWindow=function(t,i,e){return t<0?0:i&&e&&i<t+e?i-e:t},t.prototype.scrollToPosition=function(t,i,e){if(i){var o=t.top+t.height+this.config.boundaryWidth+this.config.scrollBottomOffset+(e||0);if(e){var n=o-i.clientHeight;if(i.scrollTop>n)return i.scrollTop-=n,!1}var r=i.getBoundingClientRect();if(t.top-this.config.scrollTopOffset>r.top&&o>i.clientHeight){var s=o+1-i.clientHeight;return i.scrollTop+=s,!1}if(t.top-this.config.scrollTopOffset<r.top)return i.scrollTop-=t.top-this.config.scrollTopOffset,!1}return!0},t.decorators=[{type:o.Component,args:[{selector:"lib-wizard",template:'<div *ngIf="!noWizard">\n  <div class="wizard-frame" [ngStyle]="style" [ngClass]="\'psn\' + pos"></div>\n  <div class="wizard-tip" [ngStyle]="button" *ngIf="config">\n    <nz-carousel nzEffect="fade" [nzDotRender]="dot" (nzAfterChange)="change($event)">\n      <div nz-carousel-content *ngFor="let p of config.steps;let i=index">\n        <h3>{{p.title}}</h3>\n        <p>{{p.content}}</p>\n      </div>\n    </nz-carousel>\n    <div nz-row nzType="flex" nzJustify="space-between">\n      <a (click)="close(true)">跳过引导</a>\n      <div class="wizard-buttons">\n        <button nz-button nzSize="small" nzType="default" *ngIf="currentIndex > 0" (click)="prev()">上一步</button>\n        <button nz-button nzSize="small" nzType="primary" *ngIf="currentIndex < config.steps.length -1"\n          (click)="next()">下一步</button>\n        <button nz-button nzSize="small" nzType="primary" *ngIf="currentIndex === config.steps.length -1"\n          (click)="close(false)">结束</button>\n      </div>\n    </div>\n  </div>\n\n</div>\n\n<ng-template #dot>\n  <span class="dot"></span>\n</ng-template>',encapsulation:o.ViewEncapsulation.None,styles:[".wizard-frame{position:fixed;display:block;z-index:9998;background:0 0;left:0;top:0;border-width:calc((100vh - 100px)/ 2) calc((100vw - 400px)/ 2);border-style:solid;border-color:rgba(0,0,0,.5);box-sizing:content-box;transition:.2s ease-in}.wizard-frame::before{position:absolute;content:'';width:0;height:0;border-style:solid;border-width:15px}.wizard-frame.psn0::before{border-color:#fff transparent transparent;top:-15px;left:15px}.wizard-frame.psn1::before{border-color:transparent #fff transparent transparent;right:-15px;top:15px}.wizard-frame.psn2::before{border-color:transparent transparent #fff;bottom:-15px;left:15px}.wizard-frame.psn3::before{border-color:transparent transparent transparent #fff;left:-15px;top:15px}.wizard-tip{position:fixed;width:320px;height:180px;background:#fff;z-index:9999;padding:12px;transition:.2s ease-in;box-sizing:border-box}.wizard-tip nz-carousel{height:130px}.wizard-tip [nz-carousel-content]{width:100%;overflow:hidden}.wizard-tip [nz-carousel-content] p{height:63px}.slick-active .dot{background:#1890ff;border-color:#1890ff}.dot{display:inline-block;width:12px;height:12px;border-radius:100%;background:#e6e6e6;border:1px solid #0478aa}.wizard-buttons button:not(:first-child){margin-left:8px}"]}]}],t.ctorParameters=function(){return[]},t.propDecorators={config:[{type:o.Input}],stepChange:[{type:o.Output}],carousel:[{type:o.ViewChild,args:[r.NzCarouselComponent]}]},t}(),p=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{declarations:[h],imports:[n.CommonModule,r.NzCarouselModule,r.NzButtonModule,r.NzGridModule],exports:[h]}]}],t}();t.TipDirection=c,t.WizardComponent=h,t.WizardModule=p,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=xc-wizard.umd.min.js.map